<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boardgame Pick</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="brand">
                <div class="brand-mark" aria-hidden="true">
                    <div class="brand-dice">ğŸ²</div>
                </div>
                <div class="brand-text">
                    <h1 class="brand-title">Boardgame Pick</h1>
                    <p class="brand-subtitle">ë³´ë“œê²Œì„ ì·¨í–¥ì„ ë¹ ë¥´ê²Œ ë°œê²¬í•˜ëŠ” ìŠ¤ë§ˆíŠ¸ íë ˆì´ì…˜</p>
                </div>
            </div>
        </header>

        <!-- ê²€ìƒ‰ í¼ -->
        <form class="search-form" method="GET">
            <div class="search-row">
                <input type="text" name="search" placeholder="ğŸ® ê²Œì„ëª… ê²€ìƒ‰" 
                       value="<%= search %>" class="search-input">
                <input type="text" name="searchPlayers" placeholder="ğŸ‘¥ ì¸ì› (ì˜ˆ: 2, 2-4)" 
                       value="<%= searchPlayers %>" class="search-input">
                <input type="text" name="searchBest" placeholder="â­ ë² ìŠ¤íŠ¸ (ì˜ˆ: 3, 2-4)" 
                       value="<%= searchBest %>" class="search-input">
            </div>
            <div class="search-row">
                <input type="number" name="weightMin" placeholder="ğŸ¯ ë‚œì´ë„ ìµœì†Œ" 
                       value="<%= weightMin %>" class="search-input" step="0.1" min="0" max="5">
                <input type="number" name="weightMax" placeholder="ğŸ¯ ë‚œì´ë„ ìµœëŒ€" 
                       value="<%= weightMax %>" class="search-input" step="0.1" min="0" max="5">
                <div class="checkbox-container">
                    <input type="checkbox" name="showFavoritesOnly" id="favorites" 
                           <%= showFavoritesOnly ? 'checked' : '' %>>
                    <label for="favorites">ì¦ê²¨ì°¾ê¸°ë§Œ</label>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" name="showScheduledOnly" id="scheduled" 
                           <%= showScheduledOnly ? 'checked' : '' %>>
                    <label for="scheduled">í”Œë ˆì´ ì˜ˆì •ë§Œ</label>
                </div>
                <select name="sortBy" class="search-input" style="min-width: 120px;">
                    <option value="rating" <%= sortBy === 'rating' ? 'selected' : '' %>>í‰ì ìˆœ</option>
                    <option value="myRating" <%= sortBy === 'myRating' ? 'selected' : '' %>>ë‚´ í‰ì ìˆœ</option>
                    <option value="weight" <%= sortBy === 'weight' ? 'selected' : '' %>>ë‚œì´ë„ìˆœ</option>
                    <option value="name" <%= sortBy === 'name' ? 'selected' : '' %>>ì´ë¦„ìˆœ</option>
                    <option value="players_recommended" <%= sortBy === 'players_recommended' ? 'selected' : '' %>>ì¶”ì²œì¸ì›ìˆœ</option>
                    <option value="play_time_min" <%= sortBy === 'play_time_min' ? 'selected' : '' %>>ì‹œê°„ìˆœ</option>
                </select>
                <select name="sortOrder" class="search-input" style="min-width: 80px;">
                    <option value="desc" <%= sortOrder === 'desc' ? 'selected' : '' %>>ë‚´ë¦¼ì°¨ìˆœ</option>
                    <option value="asc" <%= sortOrder === 'asc' ? 'selected' : '' %>>ì˜¤ë¦„ì°¨ìˆœ</option>
                </select>
                <button type="submit" class="search-button">ğŸ” ê²€ìƒ‰</button>
            </div>

        </form>

        <!-- í†µê³„ -->
        <div class="stats">
            ğŸ“Š ì´ <%= total %>ê°œ ê²°ê³¼ | ğŸ“„ <%= currentPage %> / <%= totalPages %> í˜ì´ì§€
        </div>

        <!-- ê²Œì„ ê·¸ë¦¬ë“œ -->
        <div class="game-grid">
            <% games.forEach(function(game) { %>
                <div class="game-card">
                    <% if (game.main_image_url) { %>
                        <img src="<%= game.main_image_url %>" alt="<%= game.name %>" class="game-image">
                    <% } %>
                    <div class="game-content">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <a href="<%= game.url %>" target="_blank" class="game-title"><%= game.displayName %></a>
                            <div style="display: flex; gap: 4px;">
                                <button class="favorite-button <%= game.is_favorite ? 'active' : '' %>" 
                                        data-rowid="<%= game.bgg_id %>" 
                                        data-favorite="<%= game.is_favorite ? 1 : 0 %>">
                                    <img src="<%= game.is_favorite ? '/images/bookmark-on.svg' : '/images/bookmark-off.svg' %>" 
                                         alt="ì¦ê²¨ì°¾ê¸°" class="bookmark-icon">
                                </button>
                                <button class="scheduled-button <%= game.is_scheduled ? 'active' : '' %>" 
                                        data-rowid="<%= game.bgg_id %>" 
                                        data-scheduled="<%= game.is_scheduled ? 1 : 0 %>">
                                    <img src="<%= game.is_scheduled ? '/images/scheduled-on.svg' : '/images/scheduled-off.svg' %>" 
                                         alt="í”Œë ˆì´ ì˜ˆì •" class="scheduled-icon">
                                </button>
                            </div>
                        </div>
                        <div class="game-info">
                            <% if (game.playersRecommendedDisplay) { %>ğŸ‘¥ <%= game.playersRecommendedDisplay %><% } %>
                            <% if (game.playersRecommendedDisplay && game.playersBestDisplay) { %> | <% } %>
                            <% if (game.playersBestDisplay) { %>â­ <%= game.playersBestDisplay %><% } %>
                        </div>
                        <div class="game-info">â±ï¸ <%= game.play_time_min || 0 %>~<%= game.play_time_max || 0 %>ë¶„ 
                            | ë‚œì´ë„: <%= game.weight || 0 %></div>
                        <div class="game-info">ğŸŒŸ <%= game.rating || 0 %> 
                            | ë‚´ í‰ì : <%= game.myRating || '-' %>
                            <button onclick="openRatingModal(<%= game.bgg_id %>)" 
                                    data-game-name="<%= game.displayName %>"
                                    class="rating-button">
                                í‰ì  ì…ë ¥
                            </button>
                            <% if (game.myRating) { %>
                                <button onclick="openReviewModal(<%= game.bgg_id %>)" 
                                        data-game-name="<%= game.displayName %>"
                                        class="review-button">
                                    ë¦¬ë·° ë³´ê¸°
                                </button>
                            <% } %>
                        </div>
                    </div>
                </div>
            <% }); %>
        </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <% if (totalPages > 1) { %>
            <div class="pagination">
                <% if (currentPage > 1) { %>
                    <a href="?page=<%= currentPage - 1 %>&search=<%= search %>&searchPlayers=<%= searchPlayers %>&searchBest=<%= searchBest %>&weightMin=<%= weightMin %>&weightMax=<%= weightMax %>&showFavoritesOnly=<%= showFavoritesOnly ? 'on' : '' %>&showScheduledOnly=<%= showScheduledOnly ? 'on' : '' %>&sortBy=<%= sortBy %>&sortOrder=<%= sortOrder %>" 
                       class="page-button">â—€ ì´ì „</a>
                <% } %>
                
                <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
                    <a href="?page=<%= i %>&search=<%= search %>&searchPlayers=<%= searchPlayers %>&searchBest=<%= searchBest %>&weightMin=<%= weightMin %>&weightMax=<%= weightMax %>&showFavoritesOnly=<%= showFavoritesOnly ? 'on' : '' %>&showScheduledOnly=<%= showScheduledOnly ? 'on' : '' %>&sortBy=<%= sortBy %>&sortOrder=<%= sortOrder %>" 
                       class="page-button <%= i === currentPage ? 'active' : '' %>"><%= i %></a>
                <% } %>
                
                <% if (currentPage < totalPages) { %>
                    <a href="?page=<%= currentPage + 1 %>&search=<%= search %>&searchPlayers=<%= searchPlayers %>&searchBest=<%= searchBest %>&weightMin=<%= weightMin %>&weightMax=<%= weightMax %>&showFavoritesOnly=<%= showFavoritesOnly ? 'on' : '' %>&showScheduledOnly=<%= showScheduledOnly ? 'on' : '' %>&sortBy=<%= sortBy %>&sortOrder=<%= sortOrder %>" 
                       class="page-button">ë‹¤ìŒ â–¶</a>
                <% } %>
            </div>
        <% } %>
    </div>

    <!-- í‰ì  ì…ë ¥ ëª¨ë‹¬ -->
    <div id="ratingModal" class="rating-modal">
        <div class="modal-content">
            <div class="modal-title">ë‚´ í‰ì  ë‚¨ê¸°ê¸°</div>
            <div class="rating-text" id="ratingText">ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
            <div class="star-rating">
                <span class="star" onclick="selectRating(1)">â­</span>
                <span class="star" onclick="selectRating(2)">â­</span>
                <span class="star" onclick="selectRating(3)">â­</span>
                <span class="star" onclick="selectRating(4)">â­</span>
                <span class="star" onclick="selectRating(5)">â­</span>
                <span class="star" onclick="selectRating(6)">â­</span>
                <span class="star" onclick="selectRating(7)">â­</span>
                <span class="star" onclick="selectRating(8)">â­</span>
                <span class="star" onclick="selectRating(9)">â­</span>
                <span class="star" onclick="selectRating(10)">â­</span>
            </div>
            <textarea id="reviewText" class="review-input" placeholder="ë¦¬ë·°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš” (ì„ íƒì‚¬í•­)"></textarea>
            <div class="modal-buttons">
                <button class="modal-button secondary" onclick="closeRatingModal()">ì·¨ì†Œ</button>
                <button class="modal-button primary" onclick="saveRating()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- ë¦¬ë·° ë³´ê¸° ëª¨ë‹¬ -->
    <div id="reviewModal" class="rating-modal">
        <div class="modal-content">
            <div class="modal-title">ë‚´ ë¦¬ë·°</div>
            <div id="reviewContent" style="margin-bottom: 20px;">
                <div style="margin-bottom: 15px;">
                    <strong>í‰ì :</strong> <span id="reviewRatingDisplay"></span>
                </div>
                <div>
                    <strong>ë¦¬ë·°:</strong>
                    <div id="reviewTextDisplay" style="margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 6px; min-height: 60px;"></div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-button secondary" onclick="closeReviewModal()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <script src="/js/main.js"></script>
    <script src="/js/toggles.js"></script>
    <script src="/js/modals.js"></script>
</body>
</html> 
