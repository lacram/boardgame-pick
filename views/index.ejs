<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boardgame Pick</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <a href="/" class="brand">
                <div class="brand-mark" aria-hidden="true">
                    <div class="brand-dice">ğŸ²</div>
                </div>
                <div class="brand-text">
                    <h1 class="brand-title">Boardgame Pick</h1>
                    <p class="brand-subtitle">ë³´ë“œê²Œì„ ì·¨í–¥ì„ ë¹ ë¥´ê²Œ ë°œê²¬í•˜ëŠ” ìŠ¤ë§ˆíŠ¸ íë ˆì´ì…˜</p>
                </div>
            </a>
            <div class="header-actions">
                <div class="user-menu">
                <button id="userMenuButton" class="user-button" aria-haspopup="true" aria-expanded="false">
                    <span class="user-icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="8" r="3.5" stroke="#1B365D" stroke-width="1.6"/>
                            <path d="M5 19.5C5.8 16.5 8.6 14.5 12 14.5C15.4 14.5 18.2 16.5 19 19.5" stroke="#1B365D" stroke-width="1.6" stroke-linecap="round"/>
                        </svg>
                    </span>
                    <span id="currentUserLabel" class="user-label"><%= currentUserId %></span>
                </button>
                <div id="userMenuDropdown" class="user-dropdown" hidden>
                    <div class="user-dropdown-title">ìœ ì € ì„ íƒ</div>
                    <div id="userList" class="user-list"></div>
                    <div class="user-add">
                        <input type="text" id="newUserId" class="user-input" placeholder="ìƒˆ ìœ ì € ID (ì˜ë¬¸/ìˆ«ì/_/-)">
                        <button id="addUserButton" class="user-add-button">ì¶”ê°€</button>
                    </div>
                </div>
                </div>
            </div>
        </header>

        <!-- ê²€ìƒ‰ í¼ -->
        <form class="search-form" method="GET">
            <div class="search-row">
                <input type="text" name="search" placeholder="ğŸ® ê²Œì„ëª… ê²€ìƒ‰" 
                       value="<%= search %>" class="search-input">
                <input type="text" name="searchPlayers" placeholder="ğŸ‘¥ ì¸ì› (ì˜ˆ: 2, 2-4)" 
                       value="<%= searchPlayers %>" class="search-input">
                <input type="text" name="searchBest" placeholder="â­ ë² ìŠ¤íŠ¸ (ì˜ˆ: 3, 2-4)" 
                       value="<%= searchBest %>" class="search-input">
            </div>
            <div class="search-row">
                <input type="number" name="weightMin" placeholder="ğŸ¯ ë‚œì´ë„ ìµœì†Œ" 
                       value="<%= weightMin %>" class="search-input" step="0.1" min="0" max="5">
                <input type="number" name="weightMax" placeholder="ğŸ¯ ë‚œì´ë„ ìµœëŒ€" 
                       value="<%= weightMax %>" class="search-input" step="0.1" min="0" max="5">
                <div class="checkbox-container">
                    <input type="checkbox" name="showFavoritesOnly" id="favorites" 
                           <%= showFavoritesOnly ? 'checked' : '' %>>
                    <label for="favorites">ì¦ê²¨ì°¾ê¸°ë§Œ</label>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" name="showWishlistOnly" id="wishlist" 
                           <%= showWishlistOnly ? 'checked' : '' %>>
                    <label for="wishlist">ìœ„ì‹œë¦¬ìŠ¤íŠ¸ë§Œ</label>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" name="showOwnedOnly" id="owned" 
                           <%= showOwnedOnly ? 'checked' : '' %>>
                    <label for="owned">ë³´ìœ ë§Œ</label>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" name="showPlannedOnly" id="planned" 
                           <%= showPlannedOnly ? 'checked' : '' %>>
                    <label for="planned">í”Œë ˆì´ ì˜ˆì •ë§Œ</label>
                </div>
                <select name="sortBy" class="search-input" style="min-width: 120px;">
                    <option value="rating" <%= sortBy === 'rating' ? 'selected' : '' %>>í‰ì ìˆœ</option>
                    <option value="myRating" <%= sortBy === 'myRating' ? 'selected' : '' %>>ë‚´ í‰ì ìˆœ</option>
                    <option value="weight" <%= sortBy === 'weight' ? 'selected' : '' %>>ë‚œì´ë„ìˆœ</option>
                    <option value="name" <%= sortBy === 'name' ? 'selected' : '' %>>ì´ë¦„ìˆœ</option>
                    <option value="players_recommended" <%= sortBy === 'players_recommended' ? 'selected' : '' %>>ì¶”ì²œì¸ì›ìˆœ</option>
                    <option value="play_time_min" <%= sortBy === 'play_time_min' ? 'selected' : '' %>>ì‹œê°„ìˆœ</option>
                </select>
                <select name="sortOrder" class="search-input" style="min-width: 80px;">
                    <option value="desc" <%= sortOrder === 'desc' ? 'selected' : '' %>>ë‚´ë¦¼ì°¨ìˆœ</option>
                    <option value="asc" <%= sortOrder === 'asc' ? 'selected' : '' %>>ì˜¤ë¦„ì°¨ìˆœ</option>
                </select>
                <button type="submit" class="search-button">ğŸ” ê²€ìƒ‰</button>
            </div>

        </form>

        <!-- í†µê³„ -->
        <div class="stats">
            ğŸ“Š ì´ <%= total %>ê°œ ê²°ê³¼ | ğŸ“„ <%= currentPage %> / <%= totalPages %> í˜ì´ì§€
        </div>

        <!-- ê²Œì„ ê·¸ë¦¬ë“œ -->
        <div class="game-grid">
            <% games.forEach(function(game) { %>
                <div class="game-card">
                    <% if (game.main_image_url) { %>
                        <img src="<%= game.main_image_url %>" alt="<%= game.name %>" class="game-image">
                    <% } %>
                    <div class="game-content">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <a href="<%= game.url %>" target="_blank" class="game-title"><%= game.displayName %></a>
                            <div style="display: flex; gap: 4px;">
                                <button class="favorite-button <%= game.is_favorite ? 'active' : '' %>" 
                                        data-rowid="<%= game.bgg_id %>" 
                                        data-favorite="<%= game.is_favorite ? 1 : 0 %>">
                                    <img src="<%= game.is_favorite ? '/images/bookmark-on.svg' : '/images/bookmark-off.svg' %>" 
                                         alt="ì¦ê²¨ì°¾ê¸°" class="bookmark-icon">
                                </button>
                                <button class="wishlist-button <%= game.is_wishlist ? 'active' : '' %>" 
                                        data-rowid="<%= game.bgg_id %>" 
                                        data-wishlist="<%= game.is_wishlist ? 1 : 0 %>">
                                    <img src="<%= game.is_wishlist ? '/images/wishlist-on.svg' : '/images/wishlist-off.svg' %>" 
                                         alt="ìœ„ì‹œë¦¬ìŠ¤íŠ¸" class="wishlist-icon">
                                </button>
                                <button class="planned-button <%= game.is_planned ? 'active' : '' %>" 
                                        data-rowid="<%= game.bgg_id %>" 
                                        data-planned="<%= game.is_planned ? 1 : 0 %>">
                                    <img src="<%= game.is_planned ? '/images/planned-on.svg' : '/images/planned-off.svg' %>" 
                                         alt="í”Œë ˆì´ ì˜ˆì •" class="planned-icon">
                                </button>
                                <button class="owned-button <%= game.is_owned ? 'active' : '' %>" 
                                        data-rowid="<%= game.bgg_id %>" 
                                        data-owned="<%= game.is_owned ? 1 : 0 %>">
                                    <img src="<%= game.is_owned ? '/images/owned-on.svg' : '/images/owned-off.svg' %>" 
                                         alt="ë³´ìœ " class="owned-icon">
                                </button>
                            </div>
                        </div>
                        <div class="game-info">
                            <% if (game.playersRecommendedDisplay) { %>ğŸ‘¥ <%= game.playersRecommendedDisplay %><% } %>
                            <% if (game.playersRecommendedDisplay && game.playersBestDisplay) { %> | <% } %>
                            <% if (game.playersBestDisplay) { %>â­ <%= game.playersBestDisplay %><% } %>
                        </div>
                        <div class="game-info">â±ï¸ <%= game.play_time_min || 0 %>~<%= game.play_time_max || 0 %>ë¶„ 
                            | ë‚œì´ë„: <%= game.weight || 0 %></div>
                        <div class="game-info game-info-actions">
                            <span>ğŸŒŸ <%= game.rating || 0 %> | ë‚´ í‰ì : <span id="myRating-<%= game.bgg_id %>"><%= game.myRating || '-' %></span></span>
                            <span class="game-actions">
                                <button onclick="openRatingModal(<%= game.bgg_id %>)" 
                                        data-game-name="<%= game.displayName %>"
                                        class="rating-button"
                                        aria-label="í‰ì  ì…ë ¥">
                                    <img src="/images/icon-pencil.svg" alt="" class="action-icon">
                                </button>
                                <button onclick="openReviewModal(<%= game.bgg_id %>)" 
                                        id="reviewButton-<%= game.bgg_id %>"
                                        data-game-name="<%= game.displayName %>"
                                        class="review-button"
                                        style="display: <%= game.myRating ? 'inline-flex' : 'none' %>;">
                                    <img src="/images/icon-chat.svg" alt="" class="action-icon">
                                </button>
                            </span>
                        </div>
                    </div>
                </div>
            <% }); %>
        </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <% if (totalPages > 1) { %>
            <div class="pagination">
                <% if (currentPage > 1) { %>
                    <a href="?page=<%= currentPage - 1 %>&search=<%= search %>&searchPlayers=<%= searchPlayers %>&searchBest=<%= searchBest %>&weightMin=<%= weightMin %>&weightMax=<%= weightMax %>&showFavoritesOnly=<%= showFavoritesOnly ? 'on' : '' %>&showWishlistOnly=<%= showWishlistOnly ? 'on' : '' %>&showOwnedOnly=<%= showOwnedOnly ? 'on' : '' %>&showPlannedOnly=<%= showPlannedOnly ? 'on' : '' %>&sortBy=<%= sortBy %>&sortOrder=<%= sortOrder %>" 
                       class="page-button">â—€ ì´ì „</a>
                <% } %>
                
                <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
                    <a href="?page=<%= i %>&search=<%= search %>&searchPlayers=<%= searchPlayers %>&searchBest=<%= searchBest %>&weightMin=<%= weightMin %>&weightMax=<%= weightMax %>&showFavoritesOnly=<%= showFavoritesOnly ? 'on' : '' %>&showWishlistOnly=<%= showWishlistOnly ? 'on' : '' %>&showOwnedOnly=<%= showOwnedOnly ? 'on' : '' %>&showPlannedOnly=<%= showPlannedOnly ? 'on' : '' %>&sortBy=<%= sortBy %>&sortOrder=<%= sortOrder %>" 
                       class="page-button <%= i === currentPage ? 'active' : '' %>"><%= i %></a>
                <% } %>
                
                <% if (currentPage < totalPages) { %>
                    <a href="?page=<%= currentPage + 1 %>&search=<%= search %>&searchPlayers=<%= searchPlayers %>&searchBest=<%= searchBest %>&weightMin=<%= weightMin %>&weightMax=<%= weightMax %>&showFavoritesOnly=<%= showFavoritesOnly ? 'on' : '' %>&showWishlistOnly=<%= showWishlistOnly ? 'on' : '' %>&showOwnedOnly=<%= showOwnedOnly ? 'on' : '' %>&showPlannedOnly=<%= showPlannedOnly ? 'on' : '' %>&sortBy=<%= sortBy %>&sortOrder=<%= sortOrder %>" 
                       class="page-button">ë‹¤ìŒ â–¶</a>
                <% } %>
            </div>
        <% } %>
    </div>

    <!-- í‰ì  ì…ë ¥ ëª¨ë‹¬ -->
    <div id="ratingModal" class="rating-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ë‚´ í‰ì  ë‚¨ê¸°ê¸°</div>
                <button class="modal-close" onclick="closeRatingModal()" aria-label="ë‹«ê¸°">âœ•</button>
            </div>
            <div class="rating-text" id="ratingText">ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
            <div class="star-rating">
                <span class="star" onclick="selectRating(1)">â˜†</span>
                <span class="star" onclick="selectRating(2)">â˜†</span>
                <span class="star" onclick="selectRating(3)">â˜†</span>
                <span class="star" onclick="selectRating(4)">â˜†</span>
                <span class="star" onclick="selectRating(5)">â˜†</span>
                <span class="star" onclick="selectRating(6)">â˜†</span>
                <span class="star" onclick="selectRating(7)">â˜†</span>
                <span class="star" onclick="selectRating(8)">â˜†</span>
                <span class="star" onclick="selectRating(9)">â˜†</span>
                <span class="star" onclick="selectRating(10)">â˜†</span>
            </div>
            <textarea id="reviewText" class="review-input" placeholder="ë¦¬ë·°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš” (ì„ íƒì‚¬í•­)"></textarea>
            <div class="modal-buttons">
                <button class="modal-button secondary" onclick="closeRatingModal()">ì·¨ì†Œ</button>
                <button class="modal-button primary" onclick="saveRating()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- ë¦¬ë·° ë³´ê¸° ëª¨ë‹¬ -->
    <div id="reviewModal" class="rating-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ë‚´ ë¦¬ë·°</div>
                <button class="modal-close" onclick="closeReviewModal()" aria-label="ë‹«ê¸°">âœ•</button>
            </div>
            <div id="reviewContent" class="review-content">
                <div class="review-meta">
                    <span class="review-label">í‰ì </span>
                    <span id="reviewRatingDisplay" class="review-rating"></span>
                </div>
                <div class="review-section">
                    <span class="review-label">ë¦¬ë·°</span>
                    <div id="reviewTextDisplay" class="review-text"></div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-button secondary" onclick="closeReviewModal()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <script src="/js/main.js"></script>
    <script src="/js/toggles.js"></script>
    <script src="/js/modals.js"></script>
    <script src="/js/users.js"></script>
</body>
</html> 
